var ps=Object.defineProperty;var Fe=Object.getOwnPropertySymbols;var fs=Object.prototype.hasOwnProperty,ys=Object.prototype.propertyIsEnumerable;var Jt=(i,t,e)=>t in i?ps(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,De=(i,t)=>{for(var e in t||(t={}))fs.call(t,e)&&Jt(i,e,t[e]);if(Fe)for(var e of Fe(t))ys.call(t,e)&&Jt(i,e,t[e]);return i};var E=(i,t,e)=>(Jt(i,typeof t!="symbol"?t+"":t,e),e);import{d as Ss,r as xs,o as Cs,m as Bs,c as Ms,a as Vs,b as Is}from"./vendor.49457cd5.js";const Ps=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}};Ps();class Le{constructor(){E(this,"angleX",0);E(this,"angleY",0);E(this,"angleZ",0);E(this,"angleEyeX",0);E(this,"angleEyeY",0);E(this,"mouseDistance",0);E(this,"autoBlink",!1)}}const Kt=class{constructor(i=0){i<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(i),this._capacity=i,this._size=0)}at(i){return this._ptr[i]}set(i,t){this._ptr[i]=t}get(i=0){const t=new Array;for(let e=i;e<this._size;e++)t.push(this._ptr[e]);return t}pushBack(i){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?Kt.s_defaultSize:this._capacity*2),this._ptr[this._size++]=i}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(i,t){this._size<i&&this.prepareCapacity(i);for(let s=0;s<i;s++)this._ptr[s]=t;this._size=i}resize(i,t=null){this.updateSize(i,t,!0)}updateSize(i,t=null,e=!0){if(this._size<i)if(this.prepareCapacity(i),e)for(let r=this._size;r<i;r++)typeof t=="function"?this._ptr[r]=JSON.parse(JSON.stringify(new t)):this._ptr[r]=t;else for(let r=this._size;r<i;r++)this._ptr[r]=t;else{const r=this._size-i;this._ptr.splice(this._size-r,r)}this._size=i}insert(i,t,e){let s=i._index;const r=t._index,a=e._index,l=a-r;this.prepareCapacity(this._size+l);const n=this._size-s;if(n>0)for(let o=0;o<n;o++)this._ptr.splice(s+o,0,null);for(let o=r;o<a;o++,s++)this._ptr[s]=t._vector._ptr[o];this._size=this._size+l}remove(i){return i<0||this._size<=i?!1:(this._ptr.splice(i,1),--this._size,!0)}erase(i){const t=i._index;return t<0||this._size<=t?i:(this._ptr.splice(t,1),--this._size,new it(this,t))}prepareCapacity(i){i>this._capacity&&(this._capacity==0?(this._ptr=new Array(i),this._capacity=i):(this._ptr.length=i,this._capacity=i))}begin(){return this._size==0?this.end():new it(this,0)}end(){return new it(this,this._size)}getOffset(i){const t=new Kt;return t._ptr=this.get(i),t._size=this.get(i).length,t._capacity=this.get(i).length,t}};let M=Kt;M.s_defaultSize=10;class it{constructor(t,e){this._vector=t!=null?t:null,this._index=e!=null?e:0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new it(this._vector,this._index++)}decrement(){return new it(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}}var Zt;(function(i){i.csmVector=M,i.iterator=it})(Zt||(Zt={}));class O{append(t,e){return this.s+=e!==void 0?t.substr(0,e):t,this}expansion(t,e){for(let s=0;s<t;s++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return this.s.length==0}constructor(t){this.s=t}}var ke;(function(i){i.csmString=O})(ke||(ke={}));class ft{getString(){return this._id}constructor(t){if(typeof t=="string"){this._id=new O(t);return}this._id=t}isEqual(t){return typeof t=="string"?this._id.isEqual(t):t instanceof O?this._id.isEqual(t.s):t instanceof ft?this._id.isEqual(t._id.s):!1}isNotEqual(t){return typeof t=="string"?!this._id.isEqual(t):t instanceof O?!this._id.isEqual(t.s):t instanceof ft?!this._id.isEqual(t._id.s):!1}}var Ae;(function(i){i.CubismId=ft})(Ae||(Ae={}));class Oe{constructor(){this._ids=new M}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;if(typeof t=="string"){if((e=this.findId(t))!=null)return e;e=new ft(t),this._ids.pushBack(e)}else return this.registerId(t.s);return e}getId(t){return this.registerId(t)}isExist(t){return typeof t=="string"?this.findId(t)!=null:this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}var Ne;(function(i){i.CubismIdManager=Oe})(Ne||(Ne={}));class D{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,s){const r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a=4;for(let l=0;l<a;++l)for(let n=0;n<a;++n)for(let o=0;o<a;++o)r[n+l*4]+=t[o+l*4]*e[n+o*4];for(let l=0;l<16;++l)s[l]=r[l]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);D.multiply(s,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const s=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);D.multiply(s,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){D.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new D;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}var Qt;(function(i){i.CubismMatrix44=D})(Qt||(Qt={}));class Et{static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){this.getModel()!=null&&this.doDrawModel()}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,s,r){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),s<0?s=0:s>1&&(s=1),r<0?r=0:r>1&&(r=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=s,this._modelColor.A=r}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisortopy=t}getAnisotropy(){return this._anisortopy}getModel(){return this._model}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisortopy=0,this._model=null,this._modelColor=new ht,this._mvpMatrix4x4=new D,this._mvpMatrix4x4.loadIdentity()}}var j;(function(i){i[i.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",i[i.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",i[i.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative"})(j||(j={}));class ht{constructor(){this.R=1,this.G=1,this.B=1,this.A=1}}var Ue;(function(i){i.CubismBlendMode=j,i.CubismRenderer=Et,i.CubismTextureColor=ht})(Ue||(Ue={}));const bs=(i,t,e)=>{ze.print(i,"[CSM]"+t,e)},Rt=(i,t,e)=>{bs(i,t+`
`,e)},X=i=>{console.assert(i)};let yt,$,St,J;yt=(i,...t)=>{Rt(rt.LogLevel_Debug,"[D]"+i,t)},$=(i,...t)=>{Rt(rt.LogLevel_Info,"[I]"+i,t)},St=(i,...t)=>{Rt(rt.LogLevel_Warning,"[W]"+i,t)},J=(i,...t)=>{Rt(rt.LogLevel_Error,"[E]"+i,t)};class ze{static print(t,e,s){if(t<v.getLoggingLevel())return;const r=v.coreLogFunction;if(!r)return;const a=e.replace(/\{(\d+)\}/g,(l,n)=>s[n]);r(a)}static dumpBytes(t,e,s){for(let r=0;r<s;r++)r%16==0&&r>0?this.print(t,`
`):r%8==0&&r>0&&this.print(t,"  "),this.print(t,"{0} ",[e[r]&255]);this.print(t,`
`)}constructor(){}}var je;(function(i){i.CubismDebug=ze})(je||(je={}));class Xe{constructor(t,e){this.first=t==null?null:t,this.second=e==null?null:e}}const te=class{constructor(i){i!=null?i<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(i),this._size=i):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(i){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new Xe(i),this._size+=1}getValue(i){let t=-1;for(let e=0;e<this._size;e++)if(this._keyValues[e].first==i){t=e;break}return t>=0?this._keyValues[t].second:(this.appendKey(i),this._keyValues[this._size-1].second)}setValue(i,t){let e=-1;for(let s=0;s<this._size;s++)if(this._keyValues[s].first==i){e=s;break}e>=0?this._keyValues[e].second=t:(this.appendKey(i),this._keyValues[this._size-1].second=t)}isExist(i){for(let t=0;t<this._size;t++)if(this._keyValues[t].first==i)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(i,t){i>this._keyValues.length&&(this._keyValues.length==0?(!t&&i<te.DefaultSize&&(i=te.DefaultSize),this._keyValues.length=i):(!t&&i<this._keyValues.length*2&&(i=this._keyValues.length*2),this._keyValues.length=i))}begin(){return new st(this,0)}end(){return new st(this,this._size)}erase(i){const t=i._index;return t<0||this._size<=t?i:(this._keyValues.splice(t,1),--this._size,new st(this,t))}dumpAsInt(){for(let i=0;i<this._size;i++)yt("{0} ,",this._keyValues[i]),yt(`
`)}};let G=te;G.DefaultSize=10;class st{constructor(t,e){this._map=t!=null?t:new G,this._index=e!=null?e:0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new st(this._map,this._index++)}decrement(){const t=new st(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}var Ye;(function(i){i.csmMap=G,i.csmPair=Xe,i.iterator=st})(Ye||(Ye={}));const Ft="Error: type mismatch",vs="Error: index out of bounds";class I{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new M){return t}getMap(t){return t}getValueByIndex(t){return I.errorValue.setErrorNotForClientCall(Ft)}getValueByString(t){return I.nullValue.setErrorNotForClientCall(Ft)}getKeys(){return I.s_dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return xt.errorValue}static staticInitializeNotForClientCall(){q.trueValue=new q(!0),q.falseValue=new q(!1),I.errorValue=new xt("ERROR",!0),I.nullValue=new ee,I.s_dummyKeys=new M}static staticReleaseNotForClientCall(){q.trueValue=null,q.falseValue=null,I.errorValue=null,I.nullValue=null,I.s_dummyKeys=null}}class w{constructor(t,e){this._error=null,this._lineCount=0,this._root=null,t!=null&&this.parseBytes(t,e)}static create(t,e){const s=new w;return s.parseBytes(t,e)?s:(w.delete(s),null)}static delete(t){}getRoot(){return this._root}arrayBufferToString(t){const e=new Uint8Array(t);let s="";for(let r=0,a=e.length;r<a;++r)s+="%"+this.pad(e[r].toString(16));return s=decodeURIComponent(s),s}pad(t){return t.length<2?"0"+t:t}parseBytes(t,e){const s=new Array(1),r=this.arrayBufferToString(t);if(this._root=this.parseValue(r,e,0,s),this._error){let a="\0";return a="Json parse error : @line "+(this._lineCount+1)+`
`,this._root=new Dt(a),$("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new xt(new O(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,s,r){if(this._error)return null;let a=null,l=s,n;for(;l<e;l++)switch(t[l]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const u=new Array(1);return n=Ts(t.slice(l),u),r[0]=t.indexOf(u[0]),new Ge(n)}case'"':return new Dt(this.parseString(t,e,l+1,r));case"[":return a=this.parseArray(t,e,l+1,r),a;case"{":return a=this.parseObject(t,e,l+1,r),a;case"n":return l+3<e?(a=new ee,r[0]=l+4):this._error="parse null",a;case"t":return l+3<e?(a=q.trueValue,r[0]=l+4):this._error="parse true",a;case"f":return l+4<e?(a=q.falseValue,r[0]=l+5):this._error="illegal ',' position",a;case",":return this._error="illegal ',' position",null;case"]":return r[0]=l,null;case`
`:this._lineCount++}return this._error="illegal end of value",null}parseString(t,e,s,r){if(this._error)return null;let a=s,l,n;const o=new O("");let u=s;for(;a<e;a++)switch(l=t[a],l){case'"':return r[0]=a+1,o.append(t.slice(u),a-u),o.s;case"//":if(a++,a-1>u&&o.append(t.slice(u),a-u),u=a+1,a<e)switch(n=t[a],n){case"\\":o.expansion(1,"\\");break;case'"':o.expansion(1,'"');break;case"/":o.expansion(1,"/");break;case"b":o.expansion(1,"\b");break;case"f":o.expansion(1,"\f");break;case"n":o.expansion(1,`
`);break;case"r":o.expansion(1,"\r");break;case"t":o.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,s,r){if(this._error)return null;const a=new We;let l="",n=s,o="";const u=Array(1);let h=!1;for(;n<e;n++){t:for(;n<e;n++)switch(o=t[n],o){case'"':if(l=this.parseString(t,e,n+1,u),this._error)return null;n=u[0],h=!0;break t;case"}":return r[0]=n+1,a;case":":this._error="illegal ':' position";break;case`
`:this._lineCount++}if(!h)return this._error="key not found",null;h=!1;t:for(;n<e;n++)switch(o=t[n],o){case":":h=!0,n++;break t;case"}":this._error="illegal '}' position";break;case`
`:this._lineCount++}if(!h)return this._error="':' not found",null;const d=this.parseValue(t,e,n,u);if(this._error)return null;n=u[0],a.put(l,d);t:for(;n<e;n++)switch(o=t[n],o){case",":break t;case"}":return r[0]=n+1,a;case`
`:this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,s,r){if(this._error)return null;let a=new qe,l=s,n;const o=new Array(1);for(;l<e;l++){const u=this.parseValue(t,e,l,o);if(this._error)return null;l=o[0],u&&a.add(u);t:for(;l<e;l++)switch(n=t[l],n){case",":break t;case"]":return r[0]=l+1,a;case`
`:++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}class Ge extends I{constructor(t){super();this._value=t}isFloat(){return!0}getString(t,e){const s="\0";return this._value=parseFloat(s),this._stringBuffer=s,this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return typeof t=="number"?Math.round(t)?!1:t==this._value:!1}}class q extends I{isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return typeof t=="boolean"?t==this._boolValue:!1}isStatic(){return!0}constructor(t){super();this._boolValue=t}}class Dt extends I{constructor(t){super();typeof t=="string"&&(this._stringBuffer=t),t instanceof O&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return typeof t=="string"?this._stringBuffer==t:t instanceof O?this._stringBuffer==t.s:!1}}class xt extends Dt{isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}constructor(t,e){typeof t=="string"?super(t):super(t),this._isStatic=e}isError(){return!0}}class ee extends I{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,xt.nullValue}constructor(){super();this._stringBuffer="NullValue"}}class qe extends I{constructor(){super();this._array=new M}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return I.errorValue.setErrorNotForClientCall(vs);const e=this._array.at(t);return e==null?I.nullValue:e}getValueByString(t){return I.errorValue.setErrorNotForClientCall(Ft)}getString(t,e){const s=e+`[
`;for(let r=this._array.begin();r.notEqual(this._array.end());r.increment()){const a=r.ptr();this._stringBuffer+=e+""+a.getString(e+" ")+`
`}return this._stringBuffer=s+e+`]
`,this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class We extends I{constructor(){super();this._map=new G}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof O){const e=this._map.getValue(t.s);return e==null?I.nullValue:e}for(let e=this._map.begin();e.notEqual(this._map.end());e.preIncrement())if(e.ptr().first==t)return e.ptr().second==null?I.nullValue:e.ptr().second;return I.nullValue}getValueByIndex(t){return I.errorValue.setErrorNotForClientCall(Ft)}getString(t,e){this._stringBuffer=e+`{
`;const s=this._map.begin();for(;s.notEqual(this._map.end());){const r=s.ptr().first,a=s.ptr().second;this._stringBuffer+=e+" "+r+" : "+a.getString(e+"   ")+` 
`,s.preIncrement()}return this._stringBuffer+=e+`}
`,this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new M;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var He;(function(i){i.CubismJson=w,i.JsonArray=qe,i.JsonBoolean=q,i.JsonError=xt,i.JsonFloat=Ge,i.JsonMap=We,i.JsonNullvalue=ee,i.JsonString=Dt,i.Value=I})(He||(He={}));function Ts(i,t){let e=0;for(let r=1;;r++){const a=i.slice(r-1,r);if(a=="e"||a=="-"||a=="E")continue;const l=i.substring(0,r),n=Number(l);if(isNaN(n))break;e=r}let s=parseFloat(i);return isNaN(s)&&(s=NaN),t[0]=i.slice(e),s}let z=!1,gt=!1,ct=null,Ct=null;const K=Object.freeze({vertexOffset:0,vertexStep:2});function ws(i){!i||(i=void 0)}class v{static startUp(t=null){if(z)return $("CubismFramework.startUp() is already done."),z;if(ct=t,ct!=null&&Live2DCubismCore.Logging.csmSetLogFunction(ct.logFunction),z=!0,z){const e=Live2DCubismCore.Version.csmGetVersion(),s=(e&4278190080)>>24,r=(e&16711680)>>16,a=e&65535,l=e;$("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+s).slice(-2),("00"+r).slice(-2),("0000"+a).slice(-4),l)}return $("CubismFramework.startUp() is complete."),z}static cleanUp(){z=!1,gt=!1,ct=null,Ct=null}static initialize(){if(X(z),!z){St("CubismFramework is not started.");return}if(gt){St("CubismFramework.initialize() skipped, already initialized.");return}I.staticInitializeNotForClientCall(),Ct=new Oe,gt=!0,$("CubismFramework.initialize() is complete.")}static dispose(){if(X(z),!z){St("CubismFramework is not started.");return}if(!gt){St("CubismFramework.dispose() skipped, not initialized.");return}I.staticReleaseNotForClientCall(),Ct.release(),Ct=null,Et.staticRelease(),gt=!1,$("CubismFramework.dispose() is complete.")}static isStarted(){return z}static isInitialized(){return gt}static coreLogFunction(t){!Live2DCubismCore.Logging.csmGetLogFunction()||Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return ct!=null?ct.loggingLevel:rt.LogLevel_Off}static getIdManager(){return Ct}constructor(){}}var rt;(function(i){i[i.LogLevel_Verbose=0]="LogLevel_Verbose",i[i.LogLevel_Debug=1]="LogLevel_Debug",i[i.LogLevel_Info=2]="LogLevel_Info",i[i.LogLevel_Warning=3]="LogLevel_Warning",i[i.LogLevel_Error=4]="LogLevel_Error",i[i.LogLevel_Off=5]="LogLevel_Off"})(rt||(rt={}));var $e;(function(i){i.Constant=K,i.csmDelete=ws,i.CubismFramework=v})($e||($e={}));class Je{}var ie;(function(i){i.ICubismModelSetting=Je})(ie||(ie={}));const Z="FileReferences",Es="Groups",Rs="Layout",Fs="HitAreas",Ds="Moc",Ls="Textures",ks="Physics",As="Pose",Os="Expressions",Ns="Motions",Ke="UserData",Q="Name",Ze="File",Us="Id",Lt="Ids",Qe="Sound",ti="FadeInTime",ei="FadeOutTime",se="LipSync",re="EyeBlink";var ii;(function(i){i[i.FrequestNode_Groups=0]="FrequestNode_Groups",i[i.FrequestNode_Moc=1]="FrequestNode_Moc",i[i.FrequestNode_Motions=2]="FrequestNode_Motions",i[i.FrequestNode_Expressions=3]="FrequestNode_Expressions",i[i.FrequestNode_Textures=4]="FrequestNode_Textures",i[i.FrequestNode_Physics=5]="FrequestNode_Physics",i[i.FrequestNode_Pose=6]="FrequestNode_Pose",i[i.FrequestNode_HitAreas=7]="FrequestNode_HitAreas"})(ii||(ii={}));class zs extends Je{constructor(t,e){super();this._json=w.create(t,e),this._json&&(this._jsonValue=new M,this._jsonValue.pushBack(this._json.getRoot().getValueByString(Es)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Z).getValueByString(Ds)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Z).getValueByString(Ns)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Z).getValueByString(Os)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Z).getValueByString(Ls)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Z).getValueByString(ks)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Z).getValueByString(As)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Fs)))}release(){w.delete(this._json),this._jsonValue=null}GetJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){return this._jsonValue.at(4).getRawString()}getTextureFileName(t){return this._jsonValue.at(4).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(t){return v.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(t).getValueByString(Us).getRawString())}getHitAreaName(t){return this._jsonValue.at(7).getValueByIndex(t).getValueByString(Q).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(Q).getRawString()}getExpressionFileName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(Ze).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Ze).getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Qe).getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(ti).toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(ei).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this._json.getRoot().getValueByString(Z).getValueByString(Ke).getRawString():""}getLayoutMap(t){const e=this._json.getRoot().getValueByString(Rs).getMap();if(e==null)return!1;let s=!1;for(const r=e.begin();r.notEqual(e.end());r.preIncrement())t.setValue(r.ptr().first,r.ptr().second.toFloat()),s=!0;return s}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const s=this._jsonValue.at(0).getValueByIndex(e);if(!(s.isNull()||s.isError())&&s.getValueByString(Q).getRawString()==re){t=s.getValueByString(Lt).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const s=this._jsonValue.at(0).getValueByIndex(e);if(!(s.isNull()||s.isError())&&s.getValueByString(Q).getRawString()==re)return v.getIdManager().getId(s.getValueByString(Lt).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const s=this._jsonValue.at(0).getValueByIndex(e);if(!(s.isNull()||s.isError())&&s.getValueByString(Q).getRawString()==se){t=s.getValueByString(Lt).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const s=this._jsonValue.at(0).getValueByIndex(e);if(!(s.isNull()||s.isError())&&s.getValueByString(Q).getRawString()==se)return v.getIdManager().getId(s.getValueByString(Lt).getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(1);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(4);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(7);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(5);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(6);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(3);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(2);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(2).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const s=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Qe);return!s.isNull()&&!s.isError()}isExistMotionFadeIn(t,e){const s=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(ti);return!s.isNull()&&!s.isError()}isExistMotionFadeOut(t,e){const s=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(ei);return!s.isNull()&&!s.isError()}isExistUserDataFile(){const t=this._json.getRoot().getValueByString(Z).getValueByString(Ke);return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(Q).getRawString()==re)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(Q).getRawString()==se)return!0;return!1}}var ae;(function(i){i.CubismModelSettingJson=zs})(ae||(ae={}));class kt{static create(){return new kt}static delete(t){}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const s=this._currentTime*2*3.14159;for(let r=0;r<this._breathParameters.getSize();++r){const a=this._breathParameters.at(r);t.addParameterValueById(a.parameterId,a.offset+a.peak*Math.sin(s/a.cycle),a.weight)}}constructor(){this._currentTime=0}}class js{constructor(t,e,s,r,a){this.parameterId=t==null?null:t,this.offset=e==null?0:e,this.peak=s==null?0:s,this.cycle=r==null?0:r,this.weight=a==null?0:a}}var si;(function(i){i.BreathParameterData=js,i.CubismBreath=kt})(si||(si={}));const ne=class{static create(i=null){return new ne(i)}static delete(i){}setBlinkingInterval(i){this._blinkingIntervalSeconds=i}setBlinkingSetting(i,t,e){this._closingSeconds=i,this._closedSeconds=t,this._openingSeconds=e}setParameterIds(i){this._parameterIds=i}getParameterIds(){return this._parameterIds}updateParameters(i,t){this._userTimeSeconds+=t;let e,s=0;switch(this._blinkingState){case F.EyeState_Closing:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,s>=1&&(s=1,this._blinkingState=F.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),e=1-s;break;case F.EyeState_Closed:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,s>=1&&(this._blinkingState=F.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),e=0;break;case F.EyeState_Opening:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,s>=1&&(s=1,this._blinkingState=F.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),e=s;break;case F.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=F.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),e=1;break;case F.EyeState_First:default:this._blinkingState=F.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),e=1;break}ne.CloseIfZero||(e=-e);for(let r=0;r<this._parameterIds.getSize();++r)i.setParameterValueById(this._parameterIds.at(r),e)}constructor(i){if(this._blinkingState=F.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new M,i!=null)for(let t=0;t<i.getEyeBlinkParameterCount();++t)this._parameterIds.pushBack(i.getEyeBlinkParameterId(t))}determinNextBlinkingTiming(){const i=Math.random();return this._userTimeSeconds+i*(2*this._blinkingIntervalSeconds-1)}};let oe=ne;oe.CloseIfZero=!0;var F;(function(i){i[i.EyeState_First=0]="EyeState_First",i[i.EyeState_Interval=1]="EyeState_Interval",i[i.EyeState_Closing=2]="EyeState_Closing",i[i.EyeState_Closed=3]="EyeState_Closed",i[i.EyeState_Opening=4]="EyeState_Opening"})(F||(F={}));var le;(function(i){i.CubismEyeBlink=oe,i.EyeState=F})(le||(le={}));const Xs=.001,ue=.5,ri="FadeInTime",ai="Link",Ys="Groups",Gs="Id";class Bt{static create(t,e){const s=new Bt,r=w.create(t,e),a=r.getRoot();a.getValueByString(ri).isNull()||(s._fadeTimeSeconds=a.getValueByString(ri).toFloat(ue),s._fadeTimeSeconds<=0&&(s._fadeTimeSeconds=ue));const l=a.getValueByString(Ys),n=l.getSize();for(let o=0;o<n;++o){const u=l.getValueByIndex(o),h=u.getSize();let d=0;for(let _=0;_<h;++_){const g=u.getValueByIndex(_),c=new Mt,S=v.getIdManager().getId(g.getValueByString(Gs).getRawString());if(c.partId=S,!g.getValueByString(ai).isNull()){const m=g.getValueByString(ai),p=m.getSize();for(let f=0;f<p;++f){const C=new Mt,y=v.getIdManager().getId(m.getValueByIndex(f).getString());C.partId=y,c.link.pushBack(C)}}s._partGroups.pushBack(c.clone()),++d}s._partGroupCounts.pushBack(d)}return w.delete(r),s}static delete(t){}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let s=0;for(let r=0;r<this._partGroupCounts.getSize();r++){const a=this._partGroupCounts.at(r);this.doFade(t,e,s,a),s+=a}this.copyPartOpacities(t)}reset(t){let e=0;for(let s=0;s<this._partGroupCounts.getSize();++s){const r=this._partGroupCounts.at(s);for(let a=e;a<e+r;++a){this._partGroups.at(a).initialize(t);const l=this._partGroups.at(a).partIndex,n=this._partGroups.at(a).parameterIndex;if(!(l<0)){t.setPartOpacityByIndex(l,a==e?1:0),t.setParameterValueByIndex(n,a==e?1:0);for(let o=0;o<this._partGroups.at(a).link.getSize();++o)this._partGroups.at(a).link.at(o).initialize(t)}}e+=r}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const s=this._partGroups.at(e);if(s.link.getSize()==0)continue;const r=this._partGroups.at(e).partIndex,a=t.getPartOpacityByIndex(r);for(let l=0;l<s.link.getSize();++l){const o=s.link.at(l).partIndex;o<0||t.setPartOpacityByIndex(o,a)}}}doFade(t,e,s,r){let a=-1,l=1;const n=.5,o=.15;for(let u=s;u<s+r;++u){const h=this._partGroups.at(u).partIndex,d=this._partGroups.at(u).parameterIndex;if(t.getParameterValueByIndex(d)>Xs){if(a>=0)break;a=u,l=t.getPartOpacityByIndex(h),l+=e/this._fadeTimeSeconds,l>1&&(l=1)}}a<0&&(a=0,l=1);for(let u=s;u<s+r;++u){const h=this._partGroups.at(u).partIndex;if(a==u)t.setPartOpacityByIndex(h,l);else{let d=t.getPartOpacityByIndex(h),_;l<n?_=l*(n-1)/n+1:_=(1-l)*n/(1-n),(1-_)*(1-l)>o&&(_=1-o/(1-l)),d>_&&(d=_),t.setPartOpacityByIndex(h,d)}}}constructor(){this._fadeTimeSeconds=ue,this._lastModel=null,this._partGroups=new M,this._partGroupCounts=new M}}class Mt{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new M,t!=null){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new Mt;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new M;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}var ni;(function(i){i.CubismPose=Bt,i.PartData=Mt})(ni||(ni={}));class oi extends D{constructor(t,e){super();this._width=t!==void 0?t:0,this._height=e!==void 0?e:0,this.setHeight(2)}setWidth(t){const e=t/this._width,s=e;this.scale(e,s)}setHeight(t){const e=t/this._height,s=e;this.scale(e,s)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){const e="width",s="height",r="x",a="y",l="center_x",n="center_y",o="top",u="bottom",h="left",d="right";for(const _=t.begin();_.notEqual(t.end());_.preIncrement()){const g=_.ptr().first,c=_.ptr().second;g==e?this.setWidth(c):g==s&&this.setHeight(c)}for(const _=t.begin();_.notEqual(t.end());_.preIncrement()){const g=_.ptr().first,c=_.ptr().second;g==r?this.setX(c):g==a?this.setY(c):g==l?this.centerX(c):g==n?this.centerY(c):g==o?this.top(c):g==u?this.bottom(c):g==h?this.left(c):g==d&&this.right(c)}}}var li;(function(i){i.CubismModelMatrix=oi})(li||(li={}));class x{constructor(t,e){this.x=t,this.y=e,this.x=t==null?0:t,this.y=e==null?0:e}add(t){const e=new x(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new x(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new x(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new x(t,t))}division(t){const e=new x(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new x(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}var ui;(function(i){i.CubismVector2=x})(ui||(ui={}));const At=class{static range(i,t,e){return i<t?i=t:i>e&&(i=e),i}static sin(i){return Math.sin(i)}static cos(i){return Math.cos(i)}static abs(i){return Math.abs(i)}static sqrt(i){return Math.sqrt(i)}static cbrt(i){if(i===0)return i;let t=i;const e=t<0;e&&(t=-t);let s;return t===1/0?s=1/0:(s=Math.exp(Math.log(t)/3),s=(t/(s*s)+2*s)/3),e?-s:s}static getEasingSine(i){return i<0?0:i>1?1:.5-.5*this.cos(i*Math.PI)}static max(i,t){return i>t?i:t}static min(i,t){return i>t?t:i}static degreesToRadian(i){return i/180*Math.PI}static radianToDegrees(i){return i*180/Math.PI}static directionToRadian(i,t){const e=Math.atan2(t.y,t.x),s=Math.atan2(i.y,i.x);let r=e-s;for(;r<-Math.PI;)r+=Math.PI*2;for(;r>Math.PI;)r-=Math.PI*2;return r}static directionToDegrees(i,t){const e=this.directionToRadian(i,t);let s=this.radianToDegrees(e);return t.x-i.x>0&&(s=-s),s}static radianToDirection(i){const t=new x;return t.x=this.sin(i),t.y=this.cos(i),t}static quadraticEquation(i,t,e){return this.abs(i)<At.Epsilon?this.abs(t)<At.Epsilon?-e:-e/t:-(t+this.sqrt(t*t-4*i*e))/(2*i)}static cardanoAlgorithmForBezier(i,t,e,s){if(this.sqrt(i)<At.Epsilon)return this.range(this.quadraticEquation(t,e,s),0,1);const r=t/i,a=e/i,l=s/i,n=(3*a-r*r)/3,o=n/3,u=(2*r*r*r-9*r*a+27*l)/27,h=u/2,d=h*h+o*o*o,_=.5,g=_+.01;if(d<0){const f=-n/3,C=f*f*f,y=this.sqrt(C),b=-u/(2*y),A=this.range(b,-1,1),R=Math.acos(A),wt=this.cbrt(y),V=2*wt,T=V*this.cos(R/3)-r/3;if(this.abs(T-_)<g)return this.range(T,0,1);const pt=V*this.cos((R+2*Math.PI)/3)-r/3;if(this.abs(pt-_)<g)return this.range(pt,0,1);const ms=V*this.cos((R+4*Math.PI)/3)-r/3;return this.range(ms,0,1)}if(d==0){let f;h<0?f=this.cbrt(-h):f=-this.cbrt(h);const C=2*f-r/3;if(this.abs(C-_)<g)return this.range(C,0,1);const y=-f-r/3;return this.range(y,0,1)}const c=this.sqrt(d),S=this.cbrt(c-h),m=this.cbrt(c+h),p=S-m-r/3;return this.range(p,0,1)}constructor(){}};let B=At;B.Epsilon=1e-5;var hi;(function(i){i.CubismMath=B})(hi||(hi={}));const he=30,gi=.01;class ci{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const s=40/10*1/he;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}const r=(this._userTimeSeconds-this._lastTimeSeconds)*he;this._lastTimeSeconds=this._userTimeSeconds;const l=.15*he,n=r*s/l,o=this._faceTargetX-this._faceX,u=this._faceTargetY-this._faceY;if(B.abs(o)<=gi&&B.abs(u)<=gi)return;const h=B.sqrt(o*o+u*u),d=s*o/h,_=s*u/h;let g=d-this._faceVX,c=_-this._faceVY;const S=B.sqrt(g*g+c*c);(S<-n||S>n)&&(g*=n/S,c*=n/S),this._faceVX+=g,this._faceVY+=c;{const m=.5*(B.sqrt(n*n+16*n*h-8*n*h)-n),p=B.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);p>m&&(this._faceVX*=m/p,this._faceVY*=m/p)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}var di;(function(i){i.CubismTargetPoint=ci})(di||(di={}));class Ot{constructor(){this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new M}static delete(t){t.release(),t=void 0,t=null}release(){this._weight=0}updateParameters(t,e,s){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(s-this._offsetSeconds),e.setFadeInStartTime(s);const n=this.getDuration();e.getEndTime()<0&&e.setEndTime(n<=0?-1:e.getStartTime()+n)}let r=this._weight;const a=this._fadeInSeconds==0?1:B.getEasingSine((s-e.getFadeInStartTime())/this._fadeInSeconds),l=this._fadeOutSeconds==0||e.getEndTime()<0?1:B.getEasingSine((e.getEndTime()-s)/this._fadeOutSeconds);r=r*a*l,e.setState(s,r),X(0<=r&&r<=1),this.doUpdateParameters(t,s,r,e),e.getEndTime()>0&&e.getEndTime()<s&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}}var ge;(function(i){i.ACubismMotion=Ot})(ge||(ge={}));const qs="FadeInTime",Ws="FadeOutTime",_i="Parameters",Hs="Id",$s="Value",Nt="Blend",Js="Add",Ks="Multiply",Zs="Overwrite",mi=1;class Ut extends Ot{static create(t,e){const s=new Ut,r=w.create(t,e),a=r.getRoot();s.setFadeInTime(a.getValueByString(qs).toFloat(mi)),s.setFadeOutTime(a.getValueByString(Ws).toFloat(mi));const l=a.getValueByString(_i).getSize();s._parameters.prepareCapacity(l);for(let n=0;n<l;++n){const o=a.getValueByString(_i).getValueByIndex(n),u=v.getIdManager().getId(o.getValueByString(Hs).getRawString()),h=o.getValueByString($s).toFloat();let d;o.getValueByString(Nt).isNull()||o.getValueByString(Nt).getString()==Js?d=Y.ExpressionBlendType_Add:o.getValueByString(Nt).getString()==Ks?d=Y.ExpressionBlendType_Multiply:o.getValueByString(Nt).getString()==Zs?d=Y.ExpressionBlendType_Overwrite:d=Y.ExpressionBlendType_Add;const _=new pi;_.parameterId=u,_.blendType=d,_.value=h,s._parameters.pushBack(_)}return w.delete(r),s}doUpdateParameters(t,e,s,r){for(let a=0;a<this._parameters.getSize();++a){const l=this._parameters.at(a);switch(l.blendType){case Y.ExpressionBlendType_Add:{t.addParameterValueById(l.parameterId,l.value,s);break}case Y.ExpressionBlendType_Multiply:{t.multiplyParameterValueById(l.parameterId,l.value,s);break}case Y.ExpressionBlendType_Overwrite:{t.setParameterValueById(l.parameterId,l.value,s);break}}}}constructor(){super();this._parameters=new M}}var Y;(function(i){i[i.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",i[i.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",i[i.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite"})(Y||(Y={}));class pi{}var ce;(function(i){i.CubismExpressionMotion=Ut,i.ExpressionBlendType=Y,i.ExpressionParameter=pi})(ce||(ce={}));var W;(function(i){i[i.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",i[i.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",i[i.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity"})(W||(W={}));var N;(function(i){i[i.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",i[i.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",i[i.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",i[i.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped"})(N||(N={}));class de{constructor(){this.time=0,this.value=0}}class fi{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class yi{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class Si{constructor(){this.fireTime=0}}class xi{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new M,this.segments=new M,this.points=new M,this.events=new M}}var Ci;(function(i){i.CubismMotionCurve=yi,i.CubismMotionCurveTarget=W,i.CubismMotionData=xi,i.CubismMotionEvent=Si,i.CubismMotionPoint=de,i.CubismMotionSegment=fi,i.CubismMotionSegmentType=N})(Ci||(Ci={}));const L="Meta",Qs="Duration",tr="Loop",er="AreBeziersRestricted",ir="CurveCount",sr="Fps",rr="TotalSegmentCount",ar="TotalPointCount",tt="Curves",nr="Target",or="Id",zt="FadeInTime",jt="FadeOutTime",Bi="Segments",Mi="UserData",lr="UserDataCount",ur="TotalUserDataSize",hr="Time",gr="Value";class Vi{constructor(t,e){this._json=w.create(t,e)}release(){w.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(L).getValueByString(Qs).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(L).getValueByString(tr).toBoolean()}getEvaluationOptionFlag(t){return Xt.EvaluationOptionFlag_AreBeziersRistricted==t?this._json.getRoot().getValueByString(L).getValueByString(er).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString(L).getValueByString(ir).toInt()}getMotionFps(){return this._json.getRoot().getValueByString(L).getValueByString(sr).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(L).getValueByString(rr).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(L).getValueByString(ar).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(L).getValueByString(zt).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(L).getValueByString(jt).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(L).getValueByString(zt).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(L).getValueByString(jt).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(tt).getValueByIndex(t).getValueByString(nr).getRawString()}getMotionCurveId(t){return v.getIdManager().getId(this._json.getRoot().getValueByString(tt).getValueByIndex(t).getValueByString(or).getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(tt).getValueByIndex(t).getValueByString(zt).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(tt).getValueByIndex(t).getValueByString(jt).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(tt).getValueByIndex(t).getValueByString(zt).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(tt).getValueByIndex(t).getValueByString(jt).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(tt).getValueByIndex(t).getValueByString(Bi).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(tt).getValueByIndex(t).getValueByString(Bi).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(L).getValueByString(lr).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(L).getValueByString(ur).toInt()}getEventTime(t){return this._json.getRoot().getValueByString(Mi).getValueByIndex(t).getValueByString(hr).toFloat()}getEventValue(t){return new O(this._json.getRoot().getValueByString(Mi).getValueByIndex(t).getValueByString(gr).getRawString())}}var Xt;(function(i){i[i.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted"})(Xt||(Xt={}));var Ii;(function(i){i.CubismMotionJson=Vi})(Ii||(Ii={}));const cr="EyeBlink",dr="LipSync",_r="Model",mr="Parameter",pr="PartOpacity",fr=!1;function U(i,t,e){const s=new de;return s.time=i.time+(t.time-i.time)*e,s.value=i.value+(t.value-i.value)*e,s}function yr(i,t){let e=(t-i[0].time)/(i[1].time-i[0].time);return e<0&&(e=0),i[0].value+(i[1].value-i[0].value)*e}function Sr(i,t){let e=(t-i[0].time)/(i[3].time-i[0].time);e<0&&(e=0);const s=U(i[0],i[1],e),r=U(i[1],i[2],e),a=U(i[2],i[3],e),l=U(s,r,e),n=U(r,a,e);return U(l,n,e).value}function xr(i,t){const e=t,s=i[0].time,r=i[3].time,a=i[1].time,l=i[2].time,n=r-3*l+3*a-s,o=3*l-6*a+3*s,u=3*a-3*s,h=s-e,d=B.cardanoAlgorithmForBezier(n,o,u,h),_=U(i[0],i[1],d),g=U(i[1],i[2],d),c=U(i[2],i[3],d),S=U(_,g,d),m=U(g,c,d);return U(S,m,d).value}function Cr(i,t){return i[0].value}function Br(i,t){return i[1].value}function _e(i,t,e){const s=i.curves.at(t);let r=-1;const a=s.baseSegmentIndex+s.segmentCount;let l=0;for(let o=s.baseSegmentIndex;o<a;++o)if(l=i.segments.at(o).basePointIndex+(i.segments.at(o).segmentType==N.CubismMotionSegmentType_Bezier?3:1),i.points.at(l).time>e){r=o;break}if(r==-1)return i.points.at(l).value;const n=i.segments.at(r);return n.evaluate(i.points.get(n.basePointIndex),e)}class Yt extends Ot{static create(t,e,s){const r=new Yt;return r.parse(t,e),r._sourceFrameRate=r._motionData.fps,r._loopDurationSeconds=r._motionData.duration,r._onFinishedMotion=s,r}doUpdateParameters(t,e,s,r){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=v.getIdManager().getId(cr)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=v.getIdManager().getId(dr));let a=e-r.getStartTime();a<0&&(a=0);let l=Number.MAX_VALUE,n=Number.MAX_VALUE;const o=64;let u=0,h=0;this._eyeBlinkParameterIds.getSize()>o&&yt("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>o&&yt("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const d=this._fadeInSeconds<=0?1:B.getEasingSine((e-r.getFadeInStartTime())/this._fadeInSeconds),_=this._fadeOutSeconds<=0||r.getEndTime()<0?1:B.getEasingSine((r.getEndTime()-e)/this._fadeOutSeconds);let g,c,S,m=a;if(this._isLoop)for(;m>this._motionData.duration;)m-=this._motionData.duration;const p=this._motionData.curves;for(c=0;c<this._motionData.curveCount&&p.at(c).type==W.CubismMotionCurveTarget_Model;++c)g=_e(this._motionData,c,m),p.at(c).id==this._modelCurveIdEyeBlink?n=g:p.at(c).id==this._modelCurveIdLipSync&&(l=g);for(;c<this._motionData.curveCount&&p.at(c).type==W.CubismMotionCurveTarget_Parameter;++c){if(S=t.getParameterIndex(p.at(c).id),S==-1)continue;const f=t.getParameterValueByIndex(S);if(g=_e(this._motionData,c,m),n!=Number.MAX_VALUE){for(let y=0;y<this._eyeBlinkParameterIds.getSize()&&y<o;++y)if(this._eyeBlinkParameterIds.at(y)==p.at(c).id){g*=n,h|=1<<y;break}}if(l!=Number.MAX_VALUE){for(let y=0;y<this._lipSyncParameterIds.getSize()&&y<o;++y)if(this._lipSyncParameterIds.at(y)==p.at(c).id){g+=l,u|=1<<y;break}}let C;if(p.at(c).fadeInTime<0&&p.at(c).fadeOutTime<0)C=f+(g-f)*s;else{let y,b;p.at(c).fadeInTime<0?y=d:y=p.at(c).fadeInTime==0?1:B.getEasingSine((e-r.getFadeInStartTime())/p.at(c).fadeInTime),p.at(c).fadeOutTime<0?b=_:b=p.at(c).fadeOutTime==0||r.getEndTime()<0?1:B.getEasingSine((r.getEndTime()-e)/p.at(c).fadeOutTime);const A=this._weight*y*b;C=f+(g-f)*A}t.setParameterValueByIndex(S,C,1)}{if(n!=Number.MAX_VALUE)for(let f=0;f<this._eyeBlinkParameterIds.getSize()&&f<o;++f){const C=t.getParameterValueById(this._eyeBlinkParameterIds.at(f));if(h>>f&1)continue;const y=C+(n-C)*s;t.setParameterValueById(this._eyeBlinkParameterIds.at(f),y)}if(l!=Number.MAX_VALUE)for(let f=0;f<this._lipSyncParameterIds.getSize()&&f<o;++f){const C=t.getParameterValueById(this._lipSyncParameterIds.at(f));if(u>>f&1)continue;const y=C+(l-C)*s;t.setParameterValueById(this._lipSyncParameterIds.at(f),y)}}for(;c<this._motionData.curveCount&&p.at(c).type==W.CubismMotionCurveTarget_PartOpacity;++c)S=t.getParameterIndex(p.at(c).id),S!=-1&&(g=_e(this._motionData,c,m),t.setParameterValueByIndex(S,g));a>=this._motionData.duration&&(this._isLoop?(r.setStartTime(e),this._isLoopFadeIn&&r.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),r.setIsFinished(!0))),this._lastWeight=s}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const s=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==s.at(r).id){s.at(r).fadeInTime=e;return}}setParameterFadeOutTime(t,e){const s=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==s.at(r).id){s.at(r).fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==e.at(s).id)return e.at(s).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==e.at(s).id)return e.at(s).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}constructor(){super();this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null}release(){this._motionData=void 0,this._motionData=null}parse(t,e){this._motionData=new xi;let s=new Vi(t,e);this._motionData.duration=s.getMotionDuration(),this._motionData.loop=s.isMotionLoop(),this._motionData.curveCount=s.getMotionCurveCount(),this._motionData.fps=s.getMotionFps(),this._motionData.eventCount=s.getEventCount();const r=s.getEvaluationOptionFlag(Xt.EvaluationOptionFlag_AreBeziersRistricted);s.isExistMotionFadeInTime()?this._fadeInSeconds=s.getMotionFadeInTime()<0?1:s.getMotionFadeInTime():this._fadeInSeconds=1,s.isExistMotionFadeOutTime()?this._fadeOutSeconds=s.getMotionFadeOutTime()<0?1:s.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,yi,!0),this._motionData.segments.updateSize(s.getMotionTotalSegmentCount(),fi,!0),this._motionData.points.updateSize(s.getMotionTotalPointCount(),de,!0),this._motionData.events.updateSize(this._motionData.eventCount,Si,!0);let a=0,l=0;for(let n=0;n<this._motionData.curveCount;++n){s.getMotionCurveTarget(n)==_r?this._motionData.curves.at(n).type=W.CubismMotionCurveTarget_Model:s.getMotionCurveTarget(n)==mr?this._motionData.curves.at(n).type=W.CubismMotionCurveTarget_Parameter:s.getMotionCurveTarget(n)==pr&&(this._motionData.curves.at(n).type=W.CubismMotionCurveTarget_PartOpacity),this._motionData.curves.at(n).id=s.getMotionCurveId(n),this._motionData.curves.at(n).baseSegmentIndex=l,this._motionData.curves.at(n).fadeInTime=s.isExistMotionCurveFadeInTime(n)?s.getMotionCurveFadeInTime(n):-1,this._motionData.curves.at(n).fadeOutTime=s.isExistMotionCurveFadeOutTime(n)?s.getMotionCurveFadeOutTime(n):-1;for(let o=0;o<s.getMotionCurveSegmentCount(n);){switch(o==0?(this._motionData.segments.at(l).basePointIndex=a,this._motionData.points.at(a).time=s.getMotionCurveSegment(n,o),this._motionData.points.at(a).value=s.getMotionCurveSegment(n,o+1),a+=1,o+=2):this._motionData.segments.at(l).basePointIndex=a-1,s.getMotionCurveSegment(n,o)){case N.CubismMotionSegmentType_Linear:{this._motionData.segments.at(l).segmentType=N.CubismMotionSegmentType_Linear,this._motionData.segments.at(l).evaluate=yr,this._motionData.points.at(a).time=s.getMotionCurveSegment(n,o+1),this._motionData.points.at(a).value=s.getMotionCurveSegment(n,o+2),a+=1,o+=3;break}case N.CubismMotionSegmentType_Bezier:{this._motionData.segments.at(l).segmentType=N.CubismMotionSegmentType_Bezier,r||fr?this._motionData.segments.at(l).evaluate=Sr:this._motionData.segments.at(l).evaluate=xr,this._motionData.points.at(a).time=s.getMotionCurveSegment(n,o+1),this._motionData.points.at(a).value=s.getMotionCurveSegment(n,o+2),this._motionData.points.at(a+1).time=s.getMotionCurveSegment(n,o+3),this._motionData.points.at(a+1).value=s.getMotionCurveSegment(n,o+4),this._motionData.points.at(a+2).time=s.getMotionCurveSegment(n,o+5),this._motionData.points.at(a+2).value=s.getMotionCurveSegment(n,o+6),a+=3,o+=7;break}case N.CubismMotionSegmentType_Stepped:{this._motionData.segments.at(l).segmentType=N.CubismMotionSegmentType_Stepped,this._motionData.segments.at(l).evaluate=Cr,this._motionData.points.at(a).time=s.getMotionCurveSegment(n,o+1),this._motionData.points.at(a).value=s.getMotionCurveSegment(n,o+2),a+=1,o+=3;break}case N.CubismMotionSegmentType_InverseStepped:{this._motionData.segments.at(l).segmentType=N.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(l).evaluate=Br,this._motionData.points.at(a).time=s.getMotionCurveSegment(n,o+1),this._motionData.points.at(a).value=s.getMotionCurveSegment(n,o+2),a+=1,o+=3;break}default:{X(0);break}}++this._motionData.curves.at(n).segmentCount,++l}}for(let n=0;n<s.getEventCount();++n)this._motionData.events.at(n).fireTime=s.getEventTime(n),this._motionData.events.at(n).value=s.getEventValue(n);s.release(),s=void 0,s=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let s=0;s<this._motionData.eventCount;++s)this._motionData.events.at(s).fireTime>t&&this._motionData.events.at(s).fireTime<=e&&this._firedEventValues.pushBack(new O(this._motionData.events.at(s).value.s));return this._firedEventValues}}var me;(function(i){i.CubismMotion=Yt})(me||(me={}));class Pi{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&Ot.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const s=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||s<this._endTimeSeconds)&&(this._endTimeSeconds=s)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut&&this._endTimeSeconds<0}getFadeOutSeconds(){return this._fadeOutSeconds}}var bi;(function(i){i.CubismMotionQueueEntry=Pi})(bi||(bi={}));class vi{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new M}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,void 0),this._motions.set(t,null));this._motions=null}startMotion(t,e,s){if(t==null)return Ti;let r=null;for(let a=0;a<this._motions.getSize();++a)r=this._motions.at(a),r!=null&&r.setFadeOut(r._motion.getFadeOutTime());return r=new Pi,r._autoDelete=e,r._motion=t,this._motions.pushBack(r),r._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}if(e._motion==null){e.release(),e=void 0,e=null,t=this._motions.erase(t);continue}if(e.isFinished())t.preIncrement();else return!1}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const s=e.ptr();if(s!=null&&s._motionQueueEntryHandle==t&&!s.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}e.release(),e=void 0,e=null,t=this._motions.erase(t)}}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const s=e.ptr();if(s!=null&&s._motionQueueEntryHandle==t)return s}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let s=!1;for(let r=this._motions.begin();r.notEqual(this._motions.end());){let a=r.ptr();if(a==null){r=this._motions.erase(r);continue}const l=a._motion;if(l==null){a.release(),a=void 0,a=null,r=this._motions.erase(r);continue}l.updateParameters(t,a,e),s=!0;const n=l.getFiredEvent(a.getLastCheckEventSeconds()-a.getStartTime(),e-a.getStartTime());for(let o=0;o<n.getSize();++o)this._eventCallBack(this,n.at(o),this._eventCustomData);a.setLastCheckEventSeconds(e),a.isFinished()?(a.release(),a=void 0,a=null,r=this._motions.erase(r)):(a.isTriggeredFadeOut()&&a.startFadeOut(a.getFadeOutSeconds(),e),r.preIncrement())}return s}}const Ti=-1;var wi;(function(i){i.CubismMotionQueueManager=vi,i.InvalidMotionQueueEntryHandleValue=Ti})(wi||(wi={}));class pe extends vi{constructor(){super();this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,s){return s==this._reservePriority&&(this._reservePriority=0),this._currentPriority=s,super.startMotion(t,e,this._userTimeSeconds)}updateMotion(t,e){this._userTimeSeconds+=e;const s=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),s}reserveMotion(t){return t<=this._reservePriority||t<=this._currentPriority?!1:(this._reservePriority=t,!0)}}var fe;(function(i){i.CubismMotionManager=pe})(fe||(fe={}));var Vt;(function(i){i[i.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter"})(Vt||(Vt={}));var H;(function(i){i[i.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",i[i.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",i[i.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle"})(H||(H={}));class Mr{constructor(){this.gravity=new x(0,0),this.wind=new x(0,0)}}class ye{}class Se{}class Ei{constructor(){this.initialPosition=new x(0,0),this.position=new x(0,0),this.lastPosition=new x(0,0),this.lastGravity=new x(0,0),this.force=new x(0,0),this.velocity=new x(0,0)}}class Ri{constructor(){this.normalizationPosition=new Se,this.normalizationAngle=new Se}}class Fi{constructor(){this.source=new ye}}class Di{constructor(){this.destination=new ye,this.translationScale=new x(0,0)}}class Li{constructor(){this.settings=new M,this.inputs=new M,this.outputs=new M,this.particles=new M,this.gravity=new x(0,0),this.wind=new x(0,0)}}var ki;(function(i){i.CubismPhysicsInput=Fi,i.CubismPhysicsNormalization=Se,i.CubismPhysicsOutput=Di,i.CubismPhysicsParameter=ye,i.CubismPhysicsParticle=Ei,i.CubismPhysicsRig=Li,i.CubismPhysicsSource=H,i.CubismPhysicsSubRig=Ri,i.CubismPhysicsTargetType=Vt,i.PhysicsJsonEffectiveForces=Mr})(ki||(ki={}));const It="Position",xe="X",Ce="Y",Be="Angle",Ai="Type",Oi="Id",et="Meta",Gt="EffectiveForces",Vr="TotalInputCount",Ir="TotalOutputCount",Pr="PhysicsSettingCount",Ni="Gravity",Ui="Wind",br="VertexCount",P="PhysicsSettings",dt="Normalization",zi="Minimum",ji="Maximum",Xi="Default",Yi="Reflect",Gi="Weight",Pt="Input",vr="Source",at="Output",Tr="Scale",wr="VertexIndex",Er="Destination",nt="Vertices",Rr="Mobility",Fr="Delay",Dr="Radius",Lr="Acceleration";class qi{constructor(t,e){this._json=w.create(t,e)}release(){w.delete(this._json)}getGravity(){const t=new x(0,0);return t.x=this._json.getRoot().getValueByString(et).getValueByString(Gt).getValueByString(Ni).getValueByString(xe).toFloat(),t.y=this._json.getRoot().getValueByString(et).getValueByString(Gt).getValueByString(Ni).getValueByString(Ce).toFloat(),t}getWind(){const t=new x(0,0);return t.x=this._json.getRoot().getValueByString(et).getValueByString(Gt).getValueByString(Ui).getValueByString(xe).toFloat(),t.y=this._json.getRoot().getValueByString(et).getValueByString(Gt).getValueByString(Ui).getValueByString(Ce).toFloat(),t}getSubRigCount(){return this._json.getRoot().getValueByString(et).getValueByString(Pr).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(et).getValueByString(Vr).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(et).getValueByString(Ir).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(et).getValueByString(br).toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(dt).getValueByString(It).getValueByString(zi).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(dt).getValueByString(It).getValueByString(ji).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(dt).getValueByString(It).getValueByString(Xi).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(dt).getValueByString(Be).getValueByString(zi).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(dt).getValueByString(Be).getValueByString(ji).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(dt).getValueByString(Be).getValueByString(Xi).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(Pt).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(Pt).getValueByIndex(e).getValueByString(Gi).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(Pt).getValueByIndex(e).getValueByString(Yi).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(Pt).getValueByIndex(e).getValueByString(Ai).getRawString()}getInputSourceId(t,e){return v.getIdManager().getId(this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(Pt).getValueByIndex(e).getValueByString(vr).getValueByString(Oi).getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(at).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(at).getValueByIndex(e).getValueByString(wr).toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(at).getValueByIndex(e).getValueByString(Tr).toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(at).getValueByIndex(e).getValueByString(Gi).toFloat()}getOutputDestinationId(t,e){return v.getIdManager().getId(this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(at).getValueByIndex(e).getValueByString(Er).getValueByString(Oi).getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(at).getValueByIndex(e).getValueByString(Ai).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(at).getValueByIndex(e).getValueByString(Yi).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(nt).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(nt).getValueByIndex(e).getValueByString(Rr).toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(nt).getValueByIndex(e).getValueByString(Fr).toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(nt).getValueByIndex(e).getValueByString(Lr).toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(nt).getValueByIndex(e).getValueByString(Dr).toFloat()}getParticlePosition(t,e){const s=new x(0,0);return s.x=this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(nt).getValueByIndex(e).getValueByString(It).getValueByString(xe).toFloat(),s.y=this._json.getRoot().getValueByString(P).getValueByIndex(t).getValueByString(nt).getValueByIndex(e).getValueByString(It).getValueByString(Ce).toFloat(),s}}var Wi;(function(i){i.CubismPhysicsJson=qi})(Wi||(Wi={}));const Hi="X",$i="Y",Ji="Angle",kr=5,Ki=100,Ar=.001;class bt{static create(t,e){const s=new bt;return s.parse(t,e),s._physicsRig.gravity.y=0,s}static delete(t){t!=null&&(t.release(),t=null)}evaluate(t,e){let s,r,a,l;const n=new x;let o,u,h,d,_,g,c,S;_=t.getModel().parameters.values,g=t.getModel().parameters.maximumValues,c=t.getModel().parameters.minimumValues,S=t.getModel().parameters.defaultValues;for(let m=0;m<this._physicsRig.subRigCount;++m){s={angle:0},n.x=0,n.y=0,o=this._physicsRig.settings.at(m),u=this._physicsRig.inputs.get(o.baseInputIndex),h=this._physicsRig.outputs.get(o.baseOutputIndex),d=this._physicsRig.particles.get(o.baseParticleIndex);for(let p=0;p<o.inputCount;++p)r=u[p].weight/Ki,u[p].sourceParameterIndex==-1&&(u[p].sourceParameterIndex=t.getParameterIndex(u[p].source.id)),u[p].getNormalizedParameterValue(n,s,_[u[p].sourceParameterIndex],c[u[p].sourceParameterIndex],g[u[p].sourceParameterIndex],S[u[p].sourceParameterIndex],o.normalizationPosition,o.normalizationAngle,u[p].reflect,r);a=B.degreesToRadian(-s.angle),n.x=n.x*B.cos(a)-n.y*B.sin(a),n.y=n.x*B.sin(a)+n.y*B.cos(a),Jr(d,o.particleCount,n,s.angle,this._options.wind,Ar*o.normalizationPosition.maximum,e,kr);for(let p=0;p<o.outputCount;++p){const f=h[p].vertexIndex;if(f<1||f>=o.particleCount)break;h[p].destinationParameterIndex==-1&&(h[p].destinationParameterIndex=t.getParameterIndex(h[p].destination.id));const C=new x;C.x=d[f].position.x-d[f-1].position.x,C.y=d[f].position.y-d[f-1].position.y,l=h[p].getValue(C,d,f,h[p].reflect,this._options.gravity);const y=h[p].destinationParameterIndex,b=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(_.subarray(y))):_.slice(y);Kr(b,c[y],g[y],l,h[p]);for(let A=y,R=0;A<_.length;A++,R++)_[A]=b[R]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new Zi,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0}release(){this._physicsRig=void 0,this._physicsRig=null}parse(t,e){this._physicsRig=new Li;let s=new qi(t,e);this._physicsRig.gravity=s.getGravity(),this._physicsRig.wind=s.getWind(),this._physicsRig.subRigCount=s.getSubRigCount(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,Ri,!0),this._physicsRig.inputs.updateSize(s.getTotalInputCount(),Fi,!0),this._physicsRig.outputs.updateSize(s.getTotalOutputCount(),Di,!0),this._physicsRig.particles.updateSize(s.getVertexCount(),Ei,!0);let r=0,a=0,l=0;for(let n=0;n<this._physicsRig.settings.getSize();++n){this._physicsRig.settings.at(n).normalizationPosition.minimum=s.getNormalizationPositionMinimumValue(n),this._physicsRig.settings.at(n).normalizationPosition.maximum=s.getNormalizationPositionMaximumValue(n),this._physicsRig.settings.at(n).normalizationPosition.defalut=s.getNormalizationPositionDefaultValue(n),this._physicsRig.settings.at(n).normalizationAngle.minimum=s.getNormalizationAngleMinimumValue(n),this._physicsRig.settings.at(n).normalizationAngle.maximum=s.getNormalizationAngleMaximumValue(n),this._physicsRig.settings.at(n).normalizationAngle.defalut=s.getNormalizationAngleDefaultValue(n),this._physicsRig.settings.at(n).inputCount=s.getInputCount(n),this._physicsRig.settings.at(n).baseInputIndex=r;for(let o=0;o<this._physicsRig.settings.at(n).inputCount;++o)this._physicsRig.inputs.at(r+o).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+o).weight=s.getInputWeight(n,o),this._physicsRig.inputs.at(r+o).reflect=s.getInputReflect(n,o),s.getInputType(n,o)==Hi?(this._physicsRig.inputs.at(r+o).type=H.CubismPhysicsSource_X,this._physicsRig.inputs.at(r+o).getNormalizedParameterValue=Nr):s.getInputType(n,o)==$i?(this._physicsRig.inputs.at(r+o).type=H.CubismPhysicsSource_Y,this._physicsRig.inputs.at(r+o).getNormalizedParameterValue=Ur):s.getInputType(n,o)==Ji&&(this._physicsRig.inputs.at(r+o).type=H.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(r+o).getNormalizedParameterValue=zr),this._physicsRig.inputs.at(r+o).source.targetType=Vt.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(r+o).source.id=s.getInputSourceId(n,o);r+=this._physicsRig.settings.at(n).inputCount,this._physicsRig.settings.at(n).outputCount=s.getOutputCount(n),this._physicsRig.settings.at(n).baseOutputIndex=a;for(let o=0;o<this._physicsRig.settings.at(n).outputCount;++o)this._physicsRig.outputs.at(a+o).destinationParameterIndex=-1,this._physicsRig.outputs.at(a+o).vertexIndex=s.getOutputVertexIndex(n,o),this._physicsRig.outputs.at(a+o).angleScale=s.getOutputAngleScale(n,o),this._physicsRig.outputs.at(a+o).weight=s.getOutputWeight(n,o),this._physicsRig.outputs.at(a+o).destination.targetType=Vt.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(a+o).destination.id=s.getOutputDestinationId(n,o),s.getOutputType(n,o)==Hi?(this._physicsRig.outputs.at(a+o).type=H.CubismPhysicsSource_X,this._physicsRig.outputs.at(a+o).getValue=jr,this._physicsRig.outputs.at(a+o).getScale=Wr):s.getOutputType(n,o)==$i?(this._physicsRig.outputs.at(a+o).type=H.CubismPhysicsSource_Y,this._physicsRig.outputs.at(a+o).getValue=Xr,this._physicsRig.outputs.at(a+o).getScale=Hr):s.getOutputType(n,o)==Ji&&(this._physicsRig.outputs.at(a+o).type=H.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(a+o).getValue=Yr,this._physicsRig.outputs.at(a+o).getScale=$r),this._physicsRig.outputs.at(a+o).reflect=s.getOutputReflect(n,o);a+=this._physicsRig.settings.at(n).outputCount,this._physicsRig.settings.at(n).particleCount=s.getParticleCount(n),this._physicsRig.settings.at(n).baseParticleIndex=l;for(let o=0;o<this._physicsRig.settings.at(n).particleCount;++o)this._physicsRig.particles.at(l+o).mobility=s.getParticleMobility(n,o),this._physicsRig.particles.at(l+o).delay=s.getParticleDelay(n,o),this._physicsRig.particles.at(l+o).acceleration=s.getParticleAcceleration(n,o),this._physicsRig.particles.at(l+o).radius=s.getParticleRadius(n,o),this._physicsRig.particles.at(l+o).position=s.getParticlePosition(n,o);l+=this._physicsRig.settings.at(n).particleCount}this.initialize(),s.release(),s=void 0,s=null}initialize(){let t,e,s;for(let r=0;r<this._physicsRig.subRigCount;++r){e=this._physicsRig.settings.at(r),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new x(0,0),t[0].lastPosition=new x(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new x(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new x(0,0),t[0].force=new x(0,0);for(let a=1;a<e.particleCount;++a)s=new x(0,0),s.y=t[a].radius,t[a].initialPosition=new x(t[a-1].initialPosition.x+s.x,t[a-1].initialPosition.y+s.y),t[a].position=new x(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastPosition=new x(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastGravity=new x(0,-1),t[a].lastGravity.y*=-1,t[a].velocity=new x(0,0),t[a].force=new x(0,0)}}}class Zi{constructor(){this.gravity=new x(0,0),this.wind=new x(0,0)}}function Or(i){let t=0;return i>0?t=1:i<0&&(t=-1),t}function Nr(i,t,e,s,r,a,l,n,o,u){i.x+=Me(e,s,r,a,l.minimum,l.maximum,l.defalut,o)*u}function Ur(i,t,e,s,r,a,l,n,o,u){i.y+=Me(e,s,r,a,l.minimum,l.maximum,l.defalut,o)*u}function zr(i,t,e,s,r,a,l,n,o,u){t.angle+=Me(e,s,r,a,n.minimum,n.maximum,n.defalut,o)*u}function jr(i,t,e,s,r){let a=i.x;return s&&(a*=-1),a}function Xr(i,t,e,s,r){let a=i.y;return s&&(a*=-1),a}function Yr(i,t,e,s,r){let a;return e>=2?r=t[e-1].position.substract(t[e-2].position):r=r.multiplyByScaler(-1),a=B.directionToRadian(r,i),s&&(a*=-1),a}function Gr(i,t){const e=B.max(i,t),s=B.min(i,t);return B.abs(e-s)}function qr(i,t){return B.min(i,t)+Gr(i,t)/2}function Wr(i,t){return JSON.parse(JSON.stringify(i.x))}function Hr(i,t){return JSON.parse(JSON.stringify(i.y))}function $r(i,t){return JSON.parse(JSON.stringify(t))}function Jr(i,t,e,s,r,a,l,n){let o,u,h,d,_=new x(0,0),g=new x(0,0),c=new x(0,0),S=new x(0,0);i[0].position=new x(e.x,e.y),o=B.degreesToRadian(s),d=B.radianToDirection(o),d.normalize();for(let m=1;m<t;++m)i[m].force=d.multiplyByScaler(i[m].acceleration).add(r),i[m].lastPosition=new x(i[m].position.x,i[m].position.y),u=i[m].delay*l*30,_=i[m].position.substract(i[m-1].position),h=B.directionToRadian(i[m].lastGravity,d)/n,_.x=B.cos(h)*_.x-_.y*B.sin(h),_.y=B.sin(h)*_.x+_.y*B.cos(h),i[m].position=i[m-1].position.add(_),g=i[m].velocity.multiplyByScaler(u),c=i[m].force.multiplyByScaler(u).multiplyByScaler(u),i[m].position=i[m].position.add(g).add(c),S=i[m].position.substract(i[m-1].position),S.normalize(),i[m].position=i[m-1].position.add(S.multiplyByScaler(i[m].radius)),B.abs(i[m].position.x)<a&&(i[m].position.x=0),u!=0&&(i[m].velocity=i[m].position.substract(i[m].lastPosition),i[m].velocity=i[m].velocity.divisionByScalar(u),i[m].velocity=i[m].velocity.multiplyByScaler(i[m].mobility)),i[m].force=new x(0,0),i[m].lastGravity=new x(d.x,d.y)}function Kr(i,t,e,s,r){let a,l,n;a=r.getScale(r.translationScale,r.angleScale),l=s*a,l<t?(l<r.valueBelowMinimum&&(r.valueBelowMinimum=l),l=t):l>e&&(l>r.valueExceededMaximum&&(r.valueExceededMaximum=l),l=e),n=r.weight/Ki,n>=1||(l=i[0]*(1-n)+l*n),i[0]=l}function Me(i,t,e,s,r,a,l,n){let o=0;const u=B.max(e,t);u<i&&(i=u);const h=B.min(e,t);h>i&&(i=h);const d=B.min(r,a),_=B.max(r,a),g=l,c=qr(h,u),S=i-c;switch(Or(S)){case 1:{const m=_-g,p=u-c;p!=0&&(o=S*(m/p),o+=g);break}case-1:{const m=d-g,p=h-c;p!=0&&(o=S*(m/p),o+=g);break}case 0:{o=g;break}}return n?o:o*-1}var Ve;(function(i){i.CubismPhysics=bt,i.Options=Zi})(Ve||(Ve={}));class qt{constructor(t,e,s,r){this.x=t,this.y=e,this.width=s,this.height=r}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}var Qi;(function(i){i.csmRect=qt})(Qi||(Qi={}));const Ie=4,Zr=10;let ot,vt,Pe;class Wt{getChannelFlagAsColor(t){return this._channelColors.at(t)}getMaskRenderTexture(){let t=0;if(this._maskTexture&&this._maskTexture.texture!=0&&(this._maskTexture.frameNo=this._currentFrameNo,t=this._maskTexture.texture),t==0){const e=this._clippingMaskBufferSize;this._colorBuffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this._colorBuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._colorBuffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Pe),this._maskTexture=new ts(this._currentFrameNo,t)}return t}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let s=Number.MAX_VALUE,r=Number.MAX_VALUE,a=Number.MIN_VALUE,l=Number.MIN_VALUE;const n=e._clippedDrawableIndexList.length;for(let o=0;o<n;o++){const u=e._clippedDrawableIndexList[o],h=t.getDrawableVertexCount(u),d=t.getDrawableVertices(u);let _=Number.MAX_VALUE,g=Number.MAX_VALUE,c=Number.MIN_VALUE,S=Number.MIN_VALUE;const m=h*K.vertexStep;for(let p=K.vertexOffset;p<m;p+=K.vertexStep){const f=d[p],C=d[p+1];f<_&&(_=f),f>c&&(c=f),C<g&&(g=C),C>S&&(S=C)}if(_!=Number.MAX_VALUE)if(_<s&&(s=_),g<r&&(r=g),c>a&&(a=c),S>l&&(l=S),s==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const p=a-s,f=l-r;e._allClippedDrawRect.x=s,e._allClippedDrawRect.y=r,e._allClippedDrawRect.width=p,e._allClippedDrawRect.height=f}}}constructor(){this._maskRenderTexture=null,this._colorBuffer=null,this._currentFrameNo=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new M,this._clippingContextListForDraw=new M,this._channelColors=new M,this._tmpBoundsOnModel=new qt,this._tmpMatrix=new D,this._tmpMatrixForMask=new D,this._tmpMatrixForDraw=new D,this._maskTexture=null;let t=new ht;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new ht,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new ht,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.pushBack(t),t=new ht,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.pushBack(t)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null,this._maskTexture&&(this.gl.deleteFramebuffer(this._maskTexture.texture),this._maskTexture=null);for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this.gl.deleteTexture(this._colorBuffer),this._colorBuffer=null}initialize(t,e,s,r){for(let a=0;a<e;a++){if(r[a]<=0){this._clippingContextListForDraw.pushBack(null);continue}let l=this.findSameClip(s[a],r[a]);l==null&&(l=new es(this,s[a],r[a]),this._clippingContextListForMask.pushBack(l)),l.addClippedDrawable(a),this._clippingContextListForDraw.pushBack(l)}}setupClippingContext(t,e){this._currentFrameNo++;let s=0;for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&s++}if(s>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._maskRenderTexture=this.getMaskRenderTexture(),e.getMvpMatrix(),e.preDraw(),this.setupLayoutBounds(s),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTexture),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r),l=a._allClippedDrawRect,n=a._layoutBounds,o=.05;this._tmpBoundsOnModel.setRect(l),this._tmpBoundsOnModel.expand(l.width*o,l.height*o);const u=n.width/this._tmpBoundsOnModel.width,h=n.height/this._tmpBoundsOnModel.height;this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(u,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(u,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());const d=a._clippingIdCount;for(let _=0;_<d;_++){const g=a._clippingIdList[_];!t.getDrawableDynamicFlagVertexPositionsDidChange(g)||(e.setIsCulling(t.getDrawableCulling(g)!=!1),e.setClippingContextBufferForMask(a),e.drawMesh(t.getDrawableTextureIndices(g),t.getDrawableVertexIndexCount(g),t.getDrawableVertexCount(g),t.getDrawableVertexIndices(g),t.getDrawableVertices(g),t.getDrawableVertexUvs(g),t.getDrawableOpacity(g),j.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Pe),e.setClippingContextBufferForMask(null),this.gl.viewport(vt[0],vt[1],vt[2],vt[3])}}findSameClip(t,e){for(let s=0;s<this._clippingContextListForMask.getSize();s++){const r=this._clippingContextListForMask.at(s),a=r._clippingIdCount;if(a!=e)continue;let l=0;for(let n=0;n<a;n++){const o=r._clippingIdList[n];for(let u=0;u<a;u++)if(t[u]==o){l++;break}}if(l==a)return r}return null}setupLayoutBounds(t){let e=t/Ie,s=t%Ie;e=~~e,s=~~s;let r=0;for(let a=0;a<Ie;a++){const l=e+(a<s?1:0);if(l!=0)if(l==1){const n=this._clippingContextListForMask.at(r++);n._layoutChannelNo=a,n._layoutBounds.x=0,n._layoutBounds.y=0,n._layoutBounds.width=1,n._layoutBounds.height=1}else if(l==2)for(let n=0;n<l;n++){let o=n%2;o=~~o;const u=this._clippingContextListForMask.at(r++);u._layoutChannelNo=a,u._layoutBounds.x=o*.5,u._layoutBounds.y=0,u._layoutBounds.width=.5,u._layoutBounds.height=1}else if(l<=4)for(let n=0;n<l;n++){let o=n%2,u=n/2;o=~~o,u=~~u;const h=this._clippingContextListForMask.at(r++);h._layoutChannelNo=a,h._layoutBounds.x=o*.5,h._layoutBounds.y=u*.5,h._layoutBounds.width=.5,h._layoutBounds.height=.5}else if(l<=9)for(let n=0;n<l;n++){let o=n%3,u=n/3;o=~~o,u=~~u;const h=this._clippingContextListForMask.at(r++);h._layoutChannelNo=a,h._layoutBounds.x=o/3,h._layoutBounds.y=u/3,h._layoutBounds.width=1/3,h._layoutBounds.height=1/3}else J("not supported mask count : {0}",l)}}getColorBuffer(){return this._colorBuffer}getClippingContextListForDraw(){return this._clippingContextListForDraw}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}}class ts{constructor(t,e){this.frameNo=t,this.texture=e}}class es{constructor(t,e,s){this._owner=t,this._clippingIdList=e,this._clippingIdCount=s,this._allClippedDrawRect=new qt,this._layoutBounds=new qt,this._clippedDrawableIndexList=[],this._matrixForMask=new D,this._matrixForDraw=new D}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class _t{static getInstance(){return ot==null&&(ot=new _t),ot}static deleteInstance(){ot&&(ot.release(),ot=null)}constructor(){this._shaderSets=new M}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,s,r,a,l,n,o,u,h,d,_,g){d||J("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let c,S,m,p;if(t.getClippingContextBufferForMask()!=null){const f=this._shaderSets.at(lt.ShaderNames_SetupMask);this.gl.useProgram(f.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(f.samplerTexture0Location,0),n.vertex==null&&(n.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(f.attributePositionLocation),this.gl.vertexAttribPointer(f.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),n.uv==null&&(n.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(f.attributeTexCoordLocation),this.gl.vertexAttribPointer(f.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const C=t.getClippingContextBufferForMask()._layoutChannelNo,y=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(C);this.gl.uniform4f(f.uniformChannelFlagLocation,y.R,y.G,y.B,y.A),this.gl.uniformMatrix4fv(f.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const b=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(f.uniformBaseColorLocation,b.x*2-1,b.y*2-1,b.getRight()*2-1,b.getBottom()*2-1),c=this.gl.ZERO,S=this.gl.ONE_MINUS_SRC_COLOR,m=this.gl.ZERO,p=this.gl.ONE_MINUS_SRC_ALPHA}else{const f=t.getClippingContextBufferForDraw()!=null,C=f?g?2:1:0;let y=new be;switch(u){case j.CubismBlendMode_Normal:default:y=this._shaderSets.at(lt.ShaderNames_NormalPremultipliedAlpha+C),c=this.gl.ONE,S=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ONE,p=this.gl.ONE_MINUS_SRC_ALPHA;break;case j.CubismBlendMode_Additive:y=this._shaderSets.at(lt.ShaderNames_AddPremultipliedAlpha+C),c=this.gl.ONE,S=this.gl.ONE,m=this.gl.ZERO,p=this.gl.ONE;break;case j.CubismBlendMode_Multiplicative:y=this._shaderSets.at(lt.ShaderNames_MultPremultipliedAlpha+C),c=this.gl.DST_COLOR,S=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ZERO,p=this.gl.ONE;break}if(this.gl.useProgram(y.shaderProgram),n.vertex==null&&(n.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(y.attributePositionLocation),this.gl.vertexAttribPointer(y.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),n.uv==null&&(n.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(y.attributeTexCoordLocation),this.gl.vertexAttribPointer(y.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),f){this.gl.activeTexture(this.gl.TEXTURE1);const b=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer();this.gl.bindTexture(this.gl.TEXTURE_2D,b),this.gl.uniform1i(y.samplerTexture1Location,1),this.gl.uniformMatrix4fv(y.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const A=t.getClippingContextBufferForDraw()._layoutChannelNo,R=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(A);this.gl.uniform4f(y.uniformChannelFlagLocation,R.R,R.G,R.B,R.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(y.samplerTexture0Location,0),this.gl.uniformMatrix4fv(y.uniformMatrixLocation,!1,_.getArray()),this.gl.uniform4f(y.uniformBaseColorLocation,h.R,h.G,h.B,h.A)}n.index==null&&(n.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(c,S,m,p)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<Zr;t++)this._shaderSets.pushBack(new be);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(Qr,ta),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(ea,ia),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(is,sa),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(is,ra),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor")}loadShaderProgram(t,e){let s=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!r)return J("Vertex shader compile error!"),0;let a=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return a?(this.gl.attachShader(s,r),this.gl.attachShader(s,a),this.gl.linkProgram(s),this.gl.getProgramParameter(s,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(a),s):(J("Failed to link program: {0}",s),this.gl.deleteShader(r),r=0,this.gl.deleteShader(a),a=0,s&&(this.gl.deleteProgram(s),s=0),0)):(J("Vertex shader compile error!"),0)}compileShaderSource(t,e){const s=e,r=this.gl.createShader(t);if(this.gl.shaderSource(r,s),this.gl.compileShader(r),!r){const l=this.gl.getShaderInfoLog(r);J("Shader compile log: {0} ",l)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)}setGl(t){this.gl=t}}class be{}var lt;(function(i){i[i.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",i[i.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",i[i.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",i[i.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",i[i.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",i[i.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",i[i.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",i[i.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",i[i.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",i[i.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted"})(lt||(lt={}));const Qr="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",ta="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",ea="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",is="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",ia="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;void main(){   gl_FragColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;}",sa="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;void main(){   vec4 col_formask = texture2D(s_texture0 , v_texCoord) * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",ra="precision mediump float;varying vec2 v_texCoord;varying vec4 v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4 u_channelFlag;uniform vec4 u_baseColor;void main(){vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;col_formask = col_formask * (1.0 - maskVal);gl_FragColor = col_formask;}";class ve extends Et{initialize(t){t.isUsingMasking()&&(this._clippingManager=new Wt,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts())),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new Wt,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts())}getClippingMaskBufferSize(){return this._clippingManager.getClippingMaskBufferSize()}constructor(){super();this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._clippingManager=new Wt,this.firstDraw=!0,this._textures=new G,this._sortedDrawableIndexList=new M,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}release(){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null}doDrawModel(){this._clippingManager!=null&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let s=0;s<t;++s){const r=e[s];this._sortedDrawableIndexList.set(r,s)}for(let s=0;s<t;++s){const r=this._sortedDrawableIndexList.at(s);!this.getModel().getDrawableDynamicFlagIsVisible(r)||(this.setClippingContextBufferForDraw(this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(r):null),this.setIsCulling(this.getModel().getDrawableCulling(r)),this.drawMesh(this.getModel().getDrawableTextureIndices(r),this.getModel().getDrawableVertexIndexCount(r),this.getModel().getDrawableVertexCount(r),this.getModel().getDrawableVertexIndices(r),this.getModel().getDrawableVertices(r),this.getModel().getDrawableVertexUvs(r),this.getModel().getDrawableOpacity(r),this.getModel().getDrawableBlendMode(r),this.getModel().getDrawableInvertedMaskBit(r)))}}drawMesh(t,e,s,r,a,l,n,o,u){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const h=this.getModelColor();this.getClippingContextBufferForMask()==null&&(h.A*=n,this.isPremultipliedAlpha()&&(h.R*=h.A,h.G*=h.A,h.B*=h.A));let d;this._textures.getValue(t)!=null?d=this._textures.getValue(t):d=null,_t.getInstance().setupShaderProgram(this,d,s,a,r,l,this._bufferData,n,o,h,this.isPremultipliedAlpha(),this.getMvpMatrix(),u),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}static doStaticRelease(){_t.deleteInstance()}setRenderState(t,e){Pe=t,vt=e}preDraw(){this.firstDraw&&(this.firstDraw=!1,this._anisortopy=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager.setGL(t),_t.getInstance().setGl(t)}}Et.staticRelease=()=>{ve.doStaticRelease()};var ss;(function(i){i.CubismClippingContext=es,i.CubismClippingManager_WebGL=Wt,i.CubismRenderTextureResource=ts,i.CubismRenderer_WebGL=ve,i.CubismShaderSet=be,i.CubismShader_WebGL=_t,i.ShaderNames=lt})(ss||(ss={}));class rs{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let s=0;s<t;++s)s<e?this._savedParameters.set(s,this._parameterValues[s]):this._savedParameters.pushBack(this._parameterValues[s])}getModel(){return this._model}getPartIndex(t){let e;const s=this._model.parts.count;for(e=0;e<s;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=s+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(this._notExistPartOpacities.isExist(t)){this._notExistPartOpacities.setValue(t,e);return}X(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const s=this.getPartIndex(t);s<0||this.setPartOpacityByIndex(s,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(X(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const s=this._model.parameters.count;for(e=0;e<s;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(X(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,s=1){if(this._notExistParameterValues.isExist(t)){this._notExistParameterValues.setValue(t,s==1?e:this._notExistParameterValues.getValue(t)*(1-s)+e*s);return}X(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=s==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-s)+e*s}setParameterValueById(t,e,s=1){const r=this.getParameterIndex(t);this.setParameterValueByIndex(r,e,s)}addParameterValueByIndex(t,e,s=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*s)}addParameterValueById(t,e,s=1){const r=this.getParameterIndex(t);this.addParameterValueByIndex(r,e,s)}multiplyParameterValueById(t,e,s=1){const r=this.getParameterIndex(t);this.multiplyParameterValueByIndex(r,e,s)}multiplyParameterValueByIndex(t,e,s=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*s))}getDrawableIndex(t){const e=this._model.drawables.count;for(let s=0;s<e;++s)if(this._drawableIds.at(s)==t)return s;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return v.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableCulling(t){const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?j.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?j.CubismBlendMode_Multiplicative:j.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let s=0;s<t;++s)this._parameterValues[s]=this._savedParameters.at(s)}initialize(){X(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const t=this._model.parameters.ids,e=this._model.parameters.count;this._parameterIds.prepareCapacity(e);for(let s=0;s<e;++s)this._parameterIds.pushBack(v.getIdManager().getId(t[s]))}{const t=this._model.parts.ids,e=this._model.parts.count;this._partIds.prepareCapacity(e);for(let s=0;s<e;++s)this._partIds.pushBack(v.getIdManager().getId(t[s]))}{const t=this._model.drawables.ids,e=this._model.drawables.count;this._drawableIds.prepareCapacity(e);for(let s=0;s<e;++s)this._drawableIds.pushBack(v.getIdManager().getId(t[s]))}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new M,this._parameterIds=new M,this._drawableIds=new M,this._partIds=new M,this._notExistPartId=new G,this._notExistParameterId=new G,this._notExistParameterValues=new G,this._notExistPartOpacities=new G}release(){this._model.release(),this._model=null}}var as;(function(i){i.CubismModel=rs})(as||(as={}));class Ht{static create(t){let e=null;const s=Live2DCubismCore.Moc.fromArrayBuffer(t);return s&&(e=new Ht(s)),e}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new rs(e),t.initialize(),++this._modelCount),t}deleteModel(t){t!=null&&(t.release(),t=null,--this._modelCount)}constructor(t){this._moc=t,this._modelCount=0}release(){X(this._modelCount==0),this._moc._release(),this._moc=null}}var ns;(function(i){i.CubismMoc=Ht})(ns||(ns={}));const os="Meta",aa="UserDataCount",na="TotalUserDataSize",Te="UserData",oa="Target",la="Id",ua="Value";class ls{constructor(t,e){this._json=w.create(t,e)}release(){w.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(os).getValueByString(aa).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(os).getValueByString(na).toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(Te).getValueByIndex(t).getValueByString(oa).getRawString()}getUserDataId(t){return v.getIdManager().getId(this._json.getRoot().getValueByString(Te).getValueByIndex(t).getValueByString(la).getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(Te).getValueByIndex(t).getValueByString(ua).getRawString()}}var us;(function(i){i.CubismModelUserDataJson=ls})(us||(us={}));const ha="ArtMesh";class hs{}class Tt{static create(t,e){const s=new Tt;return s.parseUserData(t,e),s}static delete(t){t!=null&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let s=new ls(t,e);const r=v.getIdManager().getId(ha),a=s.getUserDataCount();for(let l=0;l<a;l++){const n=new hs;n.targetId=s.getUserDataId(l),n.targetType=v.getIdManager().getId(s.getUserDataTargetType(l)),n.value=new O(s.getUserDataValue(l)),this._userDataNodes.pushBack(n),n.targetType==r&&this._artMeshUserDataNode.pushBack(n)}s.release(),s=void 0}constructor(){this._userDataNodes=new M,this._artMeshUserDataNode=new M}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var gs;(function(i){i.CubismModelUserData=Tt,i.CubismModelUserDataNode=hs})(gs||(gs={}));class we{constructor(){this.loadMotion=(t,e,s,r)=>Yt.create(t,e,r),this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._debugMode=!1,this._renderer=null,this._motionManager=new pe,this._motionManager.setEventCallback(we.cubismDefaultMotionEventCallback,this),this._expressionManager=new pe,this._dragManager=new ci}isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,s){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=s}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t){if(this._moc=Ht.create(t),this._model=this._moc.createModel(),this._model.saveParameters(),this._moc==null||this._model==null){J("Failed to CreateModel().");return}this._modelMatrix=new oi(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadExpression(t,e,s){return Ut.create(t,e)}loadPose(t,e){this._pose=Bt.create(t,e)}loadUserData(t,e){this._modelUserData=Tt.create(t,e)}loadPhysics(t,e){this._physics=bt.create(t,e)}isHit(t,e,s){const r=this._model.getDrawableIndex(t);if(r<0)return!1;const a=this._model.getDrawableVertexCount(r),l=this._model.getDrawableVertices(r);let n=l[0],o=l[0],u=l[1],h=l[1];for(let g=1;g<a;++g){const c=l[K.vertexOffset+g*K.vertexStep],S=l[K.vertexOffset+g*K.vertexStep+1];c<n&&(n=c),c>o&&(o=c),S<u&&(u=S),S>h&&(h=S)}const d=this._modelMatrix.invertTransformX(e),_=this._modelMatrix.invertTransformY(s);return n<=d&&d<=o&&u<=_&&_<=h}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(){this._renderer&&this.deleteRenderer(),this._renderer=new ve,this._renderer.initialize(this._model)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){$("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,s){const r=s;r!=null&&r.motionEventFired(e)}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,Bt.delete(this._pose),oe.delete(this._eyeBlink),kt.delete(this._breath),this._dragManager=null,bt.delete(this._physics),Tt.delete(this._modelUserData),this.deleteRenderer()}}var Ee;(function(i){i.CubismUserModel=we})(Ee||(Ee={}));const ut=v;class Ia extends ie.ICubismModelSetting{}class ga extends ae.CubismModelSettingJson{}class ca extends Qt.CubismMatrix44{}class da extends Ee.CubismUserModel{}class Pa extends ge.ACubismMotion{}class ba extends me.CubismMotion{}class va extends ce.CubismExpressionMotion{}class Ta extends fe.CubismMotionManager{}class wa extends Ve.CubismPhysics{}class _a extends le.CubismEyeBlink{}class $t extends Zt.csmVector{}class ma extends da{constructor(){super();E(this,"motionResources");E(this,"expressionResources");E(this,"lipSyncParamIds",new $t);E(this,"eyeBlinkParamIds",new $t);this.motionResources={},this.expressionResources={},this.lipSyncParamIds=new $t,this.eyeBlinkParamIds=new $t,this._lipsync=!1}setEyeBlink(t){this._eyeBlink=t}addEyeBlinkParameterId(t){this.eyeBlinkParamIds.pushBack(t)}addLipSyncParameterId(t){this.lipSyncParamIds.pushBack(t)}addMotion(t,e,s=1,r=1){const a=this.loadMotion(t,t.byteLength,e);return s>0&&a.setFadeInTime(s),r>0&&a.setFadeOutTime(r),a.setEffectIds(this.eyeBlinkParamIds,this.lipSyncParamIds),this.motionResources[e]=a,e}addExpression(t,e,s=1,r=1){const a=this.loadExpression(t,t.byteLength,e);return s>0&&a.setFadeInTime(s),r>0&&a.setFadeOutTime(r),this.expressionResources[e]=a,e}get motionNames(){return Object.keys(this.motionResources)}get isMotionFinished(){return this._motionManager.isFinished()}startMotionByName(t){const e=this.motionResources[t];!e||this._motionManager.startMotionPriority(e,!1,0)}startExpressionByName(t){const e=this.expressionResources[t];!e||this._expressionManager.startMotionPriority(e,!1,1)}update(t){this.getModel().loadParameters();const e=this._motionManager.updateMotion(this.getModel(),t),s=this._expressionManager.updateMotion(this.getModel(),t);this.getModel().saveParameters(),!e&&!s&&this._eyeBlink!=null&&this._eyeBlink.updateParameters(this._model,t),this._pose!==null&&this._pose.updateParameters(this._model,0),this._physics!=null&&this._physics.evaluate(this._model,t),this._model.update()}}const pa={autoBlink:!0,x:0,y:0,scale:1};let cs=!1;class fa{constructor(t){E(this,"canvas");E(this,"model",new ma);E(this,"point",new Le);this.canvas=t}async init(t,e,s={}){const r=this.canvas.getContext("webgl");if(r===null)throw new Error("WebGL\u672A\u5BFE\u5FDC\u306E\u30D6\u30E9\u30A6\u30B6\u3067\u3059\u3002");r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL);const a=Object.assign({},pa,s),l=r.getParameter(r.FRAMEBUFFER_BINDING);cs||(ut.startUp(),ut.initialize(),cs=!0);const n=new ga(t,t.byteLength),{moc3:o,textures:u,physics:h,expressions:d,motions:_}=e;this.model.loadModel(o),this.model.createRenderer();let g=0;for(const V of u){const T=await ya(V,r);this.model.getRenderer().bindTexture(g,T),g++}this.model.getRenderer().setIsPremultipliedAlpha(!0),this.model.getRenderer().startUp(r),a.autoBlink&&this.model.setEyeBlink(_a.create(n));for(let V=0,T=n.getEyeBlinkParameterCount();V<T;V++)this.model.addEyeBlinkParameterId(n.getEyeBlinkParameterId(V));for(let V=0,T=n.getLipSyncParameterCount();V<T;V++)this.model.addLipSyncParameterId(n.getLipSyncParameterId(V));this.model.loadPhysics(h,h.byteLength);for(const[V,T]of d)this.model.addExpression(T,V);for(const[V,T]of _)this.model.addMotion(T,V);const c=Object.assign({x:0,y:0,z:1},{x:a.x,y:a.y,z:a.scale}),S=new ca,m=()=>{this.canvas.width=this.canvas.clientWidth*devicePixelRatio,this.canvas.height=this.canvas.clientHeight*devicePixelRatio;const V=this.model.getModelMatrix();V.bottom(0),V.centerY(-1),V.translateY(-1),S.loadIdentity();const T=this.canvas.height/this.canvas.width;1<T?V.scale(1,this.canvas.width/this.canvas.height):V.scale(this.canvas.height/this.canvas.width,1),V.translateRelative(c.x,c.y),S.multiplyByMatrix(V);const pt=c.z;S.scaleRelative(pt,pt),this.model.getRenderer().setMvpMatrix(S)};m();const p=[0,0,this.canvas.width,this.canvas.height];let f=Date.now();const C=this.model.getModel(),y=ut.getIdManager(),b=()=>{const V=Date.now(),T=(V-f)/1e3;C.setParameterValueById(y.getId("ParamAngleX"),this.point.angleX,.5),C.setParameterValueById(y.getId("ParamAngleY"),this.point.angleY,.5),C.setParameterValueById(y.getId("ParamAngleZ"),this.point.angleZ,.5),C.setParameterValueById(y.getId("ParamEyeBallX"),this.point.angleEyeX,.5),C.setParameterValueById(y.getId("ParamEyeBallY"),this.point.angleEyeY,.5),C.setParameterValueById(y.getId("ParamBodyAngleZ"),this.point.angleZ/2,.05),C.saveParameters(),this.model.update(T),p[2]=this.canvas.width,p[3]=this.canvas.height,this.model.getRenderer().setRenderState(l,p),this.model.getRenderer().drawModel(),f=V,requestAnimationFrame(b)};window.addEventListener("resize",()=>{m(),b()}),b();const A=["akubi","akubi","swing","AiArt"],R=()=>{setTimeout(()=>{this.model.isMotionFinished&&this.model.startMotionByName(A[Math.floor(Math.random()*A.length)]),R()},1e3*10+Math.random()*1e3*80)};R();const wt=()=>{setTimeout(()=>{this.model.startMotionByName("mimi"),wt()},1e3*10+Math.random()*1e3*30)};wt()}updatePoint(t){Object.assign(this.point,t)}click(t){const e=this.canvas.getBoundingClientRect(),s=e.left+e.width/2,r=e.top+e.height/2,a=(t.clientX-s)/(e.width/2),l=(t.clientY-r)/(e.height/2);this.model.isHit(ut.getIdManager().getId("HitArea"),a,l)?this.model.startMotionByName("mimi"):this.model.isHit(ut.getIdManager().getId("HitArea2"),a,l)?this.model.startMotionByName("mimi"):this.model.isHit(ut.getIdManager().getId("HitArea_Body"),a,l)?this.model.startMotionByName("mimi"):this.model.isHit(ut.getIdManager().getId("HitArea_Head"),a,l)}}async function ya(i,t){return new Promise(e=>{const s=URL.createObjectURL(i),r=new Image;r.onload=()=>{const a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.generateMipmap(t.TEXTURE_2D),URL.revokeObjectURL(s),e(a)},r.addEventListener("error",()=>{console.error("image load error")}),r.src=s})}function Sa(i,t,e,s){return Math.sqrt(Math.pow(e-i,2)+Math.pow(s-t,2))}function xa(i,t,e,s){return Math.atan2(s-t,e-i)}const ds="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js",k="./misskey/live2d/ai/web/",mt={moc3:k+"ai.moc3",model3:k+"ai.model3.json",physics3:k+"ai.physics3.json",textures:[k+"ai.4096/texture_00.png"],expressions:{smile:k+"expressions/exp_01.exp3.json",surprise:k+"expressions/exp_02.exp3.json",happy:k+"expressions/exp_06.exp3.json",jitome:k+"expressions/exp_11.exp3.json",gurugurume:k+"expressions/exp_20.exp3.json"},motions:{swing:k+"motions/mtn_03.motion3.json",akubi:k+"motions/mtn_04.motion3.json",mimi:k+"motions/mtn_05.motion3.json",AiArt:k+"motions/AiArt.motion3.json"}};let _s=!1;function Ca(i,t){return new Promise((e,s)=>{const r=document.head.querySelector(`script[src="${ds}"]`);if(r)_s?Re(i,t).then(a=>{e(a)}):r.addEventListener("load",()=>{Re(i,t).then(a=>{e(a)})});else{const a=document.createElement("script");a.setAttribute("src",ds),document.head.appendChild(a),a.addEventListener("load",()=>{_s=!0,Re(i,t).then(l=>{e(l)})})}})}async function Re(i,t){try{const[e,s,r,a,l,n]=await Promise.all([fetch(mt.model3).then(d=>d.arrayBuffer()),fetch(mt.moc3).then(d=>d.arrayBuffer()),fetch(mt.physics3).then(d=>d.arrayBuffer()),Promise.all(mt.textures.map(d=>fetch(d).then(_=>_.blob()))),Promise.all(Object.entries(mt.expressions).map(([d,_])=>fetch(_).then(g=>g.arrayBuffer()).then(g=>[d,g]))),Promise.all(Object.entries(mt.motions).map(([d,_])=>fetch(_).then(g=>g.arrayBuffer()).then(g=>[d,g])))]),o=new fa(i);await o.init(e,{moc3:s,physics:r,textures:a,expressions:l,motions:n},De({autoBlink:!0},t));const u=new Le,h=d=>{const _=d.x,g=d.y,c=i.getBoundingClientRect(),S=t.eyeX?t.eyeX:c.left+c.width/2,m=t.eyeY?t.eyeY:c.top+c.height/2,p=xa(_,g,S,m),f=Math.cos(p)*Math.sin(p)*180/Math.PI,C=Sa(_,g,S,m),y=S-_,b=m-g;Object.assign(u,{angleX:-y/10,angleY:b/10,angleZ:f*(C/S)/10,angleEyeX:-y/S/10,angleEyeY:b/m/2}),o.updatePoint(u)};return document.body.addEventListener("mousemove",d=>{h({x:d.clientX,y:d.clientY})},!1),window.addEventListener("message",d=>{const{type:_,body:g}=d.data;switch(_){case"setPos":break;case"moveCursor":h(g);break;default:break}},!1),o}catch(e){alert(e.message),console.error(e)}}const Ba=Ss({setup(i,{expose:t}){let e=null;const s=xs(),r=a=>{e&&e.click(a)};return Cs(()=>{const a=new URL(window.location.href);Ca(s.value,{scale:parseFloat(a.searchParams.get("scale")||"1"),x:parseFloat(a.searchParams.get("x")||"0"),y:parseFloat(a.searchParams.get("y")||"1"),eyeX:a.searchParams.has("eyeX")?parseFloat(a.searchParams.get("eyeX")):void 0,eyeY:a.searchParams.has("eyeY")?parseFloat(a.searchParams.get("eyeY")):void 0}).then(l=>{e=Bs(l)})}),t({canvas:s,touched:r}),(a,l)=>(Vs(),Ms("canvas",{id:"canvas",ref:(n,o)=>{o.canvas=n,s.value=n},onClick:r},null,512))}});Is(Ba).mount("#app");
